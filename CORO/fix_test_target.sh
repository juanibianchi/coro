#!/bin/bash

# Script to fix COROTests target configuration
# This fixes the common issues that prevent unit tests from running

set -e

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )\" && pwd )"
cd "$SCRIPT_DIR"

echo "================================================"
echo "Fixing COROTests Target Configuration"
echo "================================================"
echo ""

echo "‚úÖ Step 1: Changed test target type from UI testing to unit testing"
echo "   (Already done - productType is now bundle.unit-test)"
echo ""

echo "üìù Step 2: Configure test scheme in Xcode"
echo ""
echo "Please follow these manual steps in Xcode:"
echo ""
echo "1. Open Xcode with:"
echo "   open CORO.xcodeproj"
echo ""
echo "2. Click on the scheme dropdown (where it says 'CORO' next to the run button)"
echo "3. Select 'Edit Scheme...'"
echo "4. In the left sidebar, click 'Test'"
echo "5. Click the '+' button at the bottom left"
echo "6. Select 'COROTests' and click 'Add'"
echo ""
echo "7. IMPORTANT: Configure Test Host"
echo "   - Click on 'COROTests' in the list"
echo "   - In the right panel, look for 'Host Application'"
echo "   - Select 'CORO' from the dropdown"
echo ""
echo "8. Click 'Close'"
echo ""
echo "Then try running tests with: Cmd + U"
echo ""
echo "================================================"
echo "Alternative: Use Simplified Tests (No MLX)"
echo "================================================"
echo ""
echo "If you continue to have MLX dependency issues,"
echo "you can use the simplified test file that doesn't"
echo "require MLX packages:"
echo ""
echo "ChatViewModelTests_NoMLX.swift"
echo ""
echo "This file has ~20 tests that work without MLX."
echo ""
echo "To use it:"
echo "1. In Xcode, open COROTests folder"
echo "2. Find ChatViewModelTests_NoMLX.swift"
echo "3. Run just that test file (click diamond icon next to class name)"
echo ""
echo "================================================"
